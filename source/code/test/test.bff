// Core
//------------------------------------------------------------------------------
{
    .ProjectName        = 'test'
    .ProjectBaseDir = '$_CURRENT_BFF_DIR_$'

    .ProjectDependencies = {
        'iceshard',
        'sdl2_driver',
        'vulkan_driver',
    }

    // Additional helper variables
    //------------------------------------------------------------------------------
    .ProjectConanModules = .WorkspaceConanModules
        + 'glm'
        + 'imgui'
    .ProjectConanModuleDependencies = { 'SDL2' }

    .VSProjectConfigurations = { }


    // Library
    //--------------------------------------------------------------------------
    ForEach( .Configuration in .Configurations )
    {
        Using( .Configuration )


        // Configuration properties
        //--------------------------------------------------------------------------
        .ConfigurationDependencies = { }
        .ConfigurationIntermediateDirectory = '$WorkspaceBuildDir$/obj/$Platform$-$Config$/$ProjectName$'
        .ConfigurationTargetDirectory = '$WorkspaceBuildDir$/bin/$Platform$-$Config$/$ProjectName$'


        // Conan Dependencies
        //--------------------------------------------------------------------------
        ForEach( .ConanModule in .ProjectConanModules )
        {
            Using( .'ConanModule_$ConanModule$_$ConanConfig$' )

            ForEach( .IncludeDir in .IncludeDirs )
            {
                ^CompilerOptions + ' /I"$IncludeDir$"'
            }
            ForEach( .Define in .Defines )
            {
                ^CompilerOptions + ' /D$Define$'
            }
            ForEach( .LibraryDir in .LibDirs )
            {
                ^LinkerOptions + ' /LIBPATH:"$LibraryDir$"'
            }
            ForEach( .Library in .Libs )
            {
                ^LinkerOptions + ' "$Library$.lib"'
            }
        }

        ForEach( .ConanModule in .ProjectConanModuleDependencies )
        {
            Using( .'ConanModule_$ConanModule$_$ConanConfig$' )

            .CopyDirs = false
            .CopyDirsList = { }
            ForEach( .BinDir in .BinDirs )
            {
                ^CopyDirs = true
                ^CopyDirsList + "$BinDir$/"
            }

            If ( .CopyDirs )
            {
                CopyDir( '$ProjectName$-$Platform$-$Config$-$ConanModule$-copydir' )
                {
                    .SourcePaths = .CopyDirsList
                    .SourcePathsPattern = '*.dll'
                    .Dest = .ConfigurationTargetDirectory
                }
                ^ConfigurationDependencies + '$ProjectName$-$Platform$-$Config$-$ConanModule$-copydir'
            }
        }


        // Object lists
        //--------------------------------------------------------------------------
        ObjectList( '$ProjectName$-$Platform$-$Config$-objects' )
        {
            .CompilerOptions + ' /I"$ProjectBaseDir$/public"'
                + ' /I"$WorkspaceCodeDir$/core/public"'
                + ' /I"$WorkspaceCodeDir$/memsys/public"'
                + ' /I"$WorkspaceCodeDir$/messages/public"'
                + ' /I"$WorkspaceCodeDir$/collections/public"'
                + ' /I"$WorkspaceCodeDir$/resource_system/public"'
                + ' /I"$WorkspaceCodeDir$/asset_system/public"'
                + ' /I"$WorkspaceCodeDir$/input_system/public"'
                + ' /I"$WorkspaceCodeDir$/render_system/public"'
                + ' /I"$WorkspaceCodeDir$/application/public"'
                + ' /I"$WorkspaceCodeDir$/engine/public"'

            .CompilerOutputPath = .ConfigurationIntermediateDirectory
            .CompilerInputPath = '$ProjectBaseDir$/private'
            .CompilerInputPattern = '*.c*'
        }


        // Library target
        //--------------------------------------------------------------------------
        Executable( '$ProjectName$-$Platform$-$Config$' )
        {
            .Libraries = {
                '$ProjectName$-$Platform$-$Config$-objects'
                'core-$Platform$-$Config$'
                'memsys-$Platform$-$Config$'
                'messages-$Platform$-$Config$'
                'collections-$Platform$-$Config$'
                'resource_system-$Platform$-$Config$'
                'asset_system-$Platform$-$Config$'
                'input_system-$Platform$-$Config$'
                'render_system-$Platform$-$Config$'
                'engine-$Platform$-$Config$'
                'application-$Platform$-$Config$-objects'
            }

            .LinkerOutput = '$ConfigurationTargetDirectory$/$ProjectName$.exe'

            .PreBuildDependencies = .ConfigurationDependencies

            ForEach( .Dependency in .ProjectDependencies )
            {
                ^PreBuildDependencies + "$Dependency$-$Platform$-$Config$"
            }
        }


        // Visual Studio project configuration
        //--------------------------------------------------------------------------
        .VSProjectConfiguration =
        [
            .PlatformToolset = .PlatformToolset

            .Platform = .Platform
            .Config = .Config
            .Target = '$ProjectName$-$Platform$-$Config$-objects'

            .IntermediateDirectory = .ConfigurationIntermediateDirectory
            .OutputDirectory = .ConfigurationTargetDirectory
            .Output = '$ConfigurationTargetDirectory$/$ProjectName$.exe'

            .ProjectBuildCommand = '$VSBuildCommand$ $ProjectName$-$Platform$-$Config$'
            .ProjectRebuildCommand = '$VSRebuildCommand$ $ProjectName$-$Platform$-$Config$'
        ]
        ^VSProjectConfigurations + .VSProjectConfiguration
    }

    // Create a Visual Studio project description
    //--------------------------------------------------------------------------
    VCXProject( '$ProjectName$-vcxproj' )
    {
        .ProjectOutput = '$ProjectName$.vcxproj'
        .ProjectConfigs = .VSProjectConfigurations
        .ProjectInputPaths = .ProjectBaseDir
        .ProjectBasePath = .ProjectBaseDir
    }

    // Register this project
    //--------------------------------------------------------------------------
    ^Projects + .ProjectName
    ^VisualStudioProjects + .ProjectName
}
